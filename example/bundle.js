!function t(e,r,i){function n(o,s){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[o]={exports:{}};e[o][0].call(h.exports,function(t){var r=e[o][1][t];return n(r?r:t)},h,h.exports,t,e,r,i)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var n=t("../src/Trial.js"),a=i(n),o=t("../src/Courtroom.js"),s=i(o),u=t("../src/Animation.js"),c=(i(u),t("../src/Coordenada.js")),h=(i(c),t("../src/SceneRenderer.js")),l=i(h),f=t("../src/HudRenderer.js"),p=i(f);document.addEventListener("DOMContentLoaded",function(){var t=window.innerWidth,e=Math.floor(9/16*t);e>window.innerHeight&&(e=window.innerHeight,t=Math.floor(16/9*e));var r=new a["default"](t,e),i=new l["default"](t,e);i.createCamera(),i.addElement(new s["default"]),r.setupRenderer("scene",i),document.querySelector("body").appendChild(i.canvas);var n=new p["default"](t,e);r.setupRenderer("hud",n),document.querySelector("body").appendChild(n.canvas),[{id:"naegi",name:"Makoto Naegi"},{id:"yamada",name:"Hifumi Yamada"},{id:"fukawa",name:"Touko Fukawa"},{id:"kuwata",name:"Leon Kuwata"},{id:"celes",name:"Celestia Ludenberg"},{id:"togami",name:"Byakuya Togami"},{id:"fujisaki",name:"Chihiro Fujisaki"},{id:"hagakure",name:"Yasuhiro Hagakure",sprite:0},null,{id:"asahina",name:"Aoi Asahina"},{id:"oowada",name:"Mondo Oowada"},{id:"kirigiri",name:"Kyouko Kirigiri"},{id:"oogami",name:"Sakura Oogami"},{id:"enoshima",name:"Junko Enoshima"},{id:"ishimaru",name:"Kiyotaka Ishimaru"},{id:"maizono",name:"Sayaka Maizono"}].forEach(r.setCharacter,r),r.putTheFuckingBear(),r.setNarrator("Narrator"),r.changeStage("discussion"),r.stage.screen.setDialogue(r.characters.naegi,"This is a very early preview test for the dangan-engine project. Press the button in the corner to start.",!0),r.stage.justKeepRendering(),document.querySelector("#boton").addEventListener("click",function(){r.loadScript("/example/demo_001_discussion.json")},!1)},!1)},{"../src/Animation.js":2,"../src/Coordenada.js":5,"../src/Courtroom.js":6,"../src/HudRenderer.js":9,"../src/SceneRenderer.js":11,"../src/Trial.js":18}],2:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=t("./Coordenada.js"),s=i(o),u=t("./Videographer.js"),c=i(u),h=function(){function t(e){n(this,t),this.scene=e.scene,this.hud=e.hud}return a(t,[{key:"cutTo",value:function(t){return new Promise(function(e){this.processor=function(){"fov"in t&&(this.mainCamera.fov=t.fov,this.mainCamera.updateProjectionMatrix()),"position"in t&&this.mainCamera.position.copy(s["default"].parse(t.position)),"up"in t&&this.mainCamera.up.copy(s["default"].parse(t.up)),"direction"in t&&this.mainCamera.lookAt(s["default"].parse(t.direction)),this.processor=null,t=null,e()}}.bind(this.scene))}},{key:"transicion",value:function(t){return"preset"in t?this[t.preset](t):new Promise(function(e){var r=new c["default"](t.duration||6e3,t.path,t.easing);"fov"in t&&r.setupFOV(t.fov.start||this.mainCamera.fov,t.fov.end||t.fov,t.fov),"position"in t&&r.setupPosition(t.position.start||this.mainCamera.position,t.position.end||t.position,t.position),"up"in t&&r.setupUp(t.up.start||this.mainCamera.up,t.up.end||t.up,t.up),"direction"in t&&r.setupDirection(t.direction.start||new THREE.Vector3(0,0,-10).applyMatrix4(this.mainCamera.matrixWorld),t.direction.end||t.direction,t.direction),t=null,this.processor=function(t){var i=r.delta(t);r.runStage(this.mainCamera,i),i>1&&(this.processor=null,r=null,e())}}.bind(this.scene))}}]),t}();r["default"]=h,e.exports=r["default"]},{"./Coordenada.js":5,"./Videographer.js":19}],3:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(){var t,e,r=Math.floor(this.image.naturalWidth/3),i=this.image.naturalHeight,n=document.createElement("canvas").getContext("2d");for(n.canvas.width=r,n.canvas.height=i,n.drawImage(this.image,r,0,r,i,r,0,r,i),e=n.getImageData(r,0,r,i),t=0;t<e.data.length;t+=4)if(0!=e.data[t]){this.headLevel=6*(i-Math.floor(t/r))/7;break}e=null,n=null,this.needsUpdate=!0}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.id=e.id,this.name=e.name,this.texture=new THREE.Texture(new Image),this.texture.image.onload=n.bind(this.texture),e.id!=t.NARRATOR&&this.changeSprite("sprite"in e?e.sprite:1)}return a(t,[{key:"changeSprite",value:function(t){this.sprite=t,this.texture.image.src=this.fullbodySpriteUri}},{key:"fullbodySpriteUri",get:function(){return t.RESOURCES_PATH+t.FULLBODY_PATH+this.id+"/"+this.sprite+".png"}},{key:"bustSpriteUri",get:function(){return t.RESOURCES_PATH+t.BUST_PATH+this.id+".png"}}]),t}();o.RESOURCES_PATH="/resources/",o.FULLBODY_PATH="sprites/",o.BUST_PATH="busts/",o.NARRATOR="narrator",r["default"]=o,e.exports=r["default"]},{}],4:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},o=function(t){function e(t){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.counter=-1,this.front=new THREE.Mesh(e.geometry,new THREE.MeshBasicMaterial({map:t.texture,transparent:!0,color:16777215,side:THREE.FrontSide})),this.front.position.x=.02,this.back=new THREE.Mesh(e.geometry,new THREE.MeshBasicMaterial({map:t.texture,transparent:!0,color:0,side:THREE.BackSide})),this.back.position.x=-.02,this.add(this.front,this.back),t.card=this}return n(e,t),e}(THREE.Object3D);o.geometry=new THREE.PlaneBufferGeometry(10,20),r["default"]=o,e.exports=r["default"]},{}],5:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r,n){i(this,t),this.x=e||0,this.y=r||0,this.z=n||0}return n(t,[{key:"toString",value:function(){return"{x:"+this.x+", y:"+this.y+", z: "+this.z+"}"}},{key:"setSpherical",value:function(t,e,r){this.x=t*Math.sin(e)*Math.cos(r),this.y=t*Math.sin(e)*Math.sin(r),this.z=t*Math.cos(e)}},{key:"setPolar",value:function(t,e,r){this.x=t*Math.cos(e),this.y=t*Math.sin(e),this.z=isFinite(r)?r:this.z}},{key:"r",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+(this.spherical?this.z*this.z:0))},set:function(t){this.spherical?this.setSpherical(t,this.t,this.p):this.setPolar(t,this.p)}},{key:"t",get:function(){return Math.acos(this.z/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z))},set:function(t){this.setSpherical(this.r,t,this.p)}},{key:"p",get:function(){return Math.atan2(this.y,this.x)},set:function(t){this.spherical?this.setSpherical(this.r,this.t,t):this.setPolar(this.r,t)}},{key:"vector3",get:function(){return new THREE.Vector3(this.x,this.y,this.z)}}]),t}();a.parse=function(t){if(t instanceof this)return t;if(t.hasOwnProperty("x"))return new this(t.x,t.y,t.z);if(t.hasOwnProperty("t")){var e=new this;return e.spherical=!0,e.setSpherical(t.r,t.t,t.p),e}if(t.hasOwnProperty("p")){var e=new this;return e.setPolar(t.r,t.p,t.z),e}if(Array.isArray(t))return new this(t[0],t[1],t[2]);throw new Error("Coordenada.parse: Couldn't parse input.")},r["default"]=a,e.exports=r["default"]},{}],6:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t){var e=new THREE.Texture(new Image);return e.image.onload=s.bind(e),e.image.src=E.TEXTURE_RELATIVE_URI+t,e}function s(){this.needsUpdate=!0}Object.defineProperty(r,"__esModule",{value:!0});var u,c=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},l=t("./CylinderBufferGeometry.js"),f=i(l),p=t("./PlatformBufferGeometry.js"),d=i(p),y=t("./StandGeometry.js"),v=i(y),E=function(t){function e(t,r){n(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),u={WALLPAPER:o("chapter1-wallpaper.png"),BASEBOARD:o("chapter1-guardapolvo.png"),REDCARPET:o("alfombraR.png"),CURTAIN:o("chapter1-salida.png"),COLUMN:o("chapter1-marcos.png"),WOOD:o("wood.jpg"),CLOUDS:o("clouds.jpg")},t=t||120,r=r||80,this.add(new m(2*t,22),new b(8,r,t),new w(8,t-1).setCarpets(10,100).setCurtains(48).setPillars(3,r),new g,new T)}return a(e,t),e}(THREE.Object3D),m=function(t){function e(t,r){n(this,e);var i,a,o,s,u;for(t=t||120,r=r||18,i=new THREE.MeshFaceMaterial([new THREE.MeshLambertMaterial({color:0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:4}),new THREE.MeshLambertMaterial({color:16777215,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:4})]),a=new THREE.PlaneGeometry(t,t,r,r),u=a.faces.length/2,o=0;u>o;o++)s=2*o,a.faces[s].materialIndex=(o+Math.floor(o/r))%2,a.faces[s+1].materialIndex=(o+Math.floor(o/r))%2;h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,a,i),this.rotation.z=Math.PI/8,this.position.z=-.05,i=a=null}return a(e,t),e}(THREE.Mesh),b=function(t){function e(t,r,i){n(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var a,o;a=new THREE.MeshBasicMaterial({color:2959463,side:THREE.BackSide,map:u.WALLPAPER}),o=new f["default"](t,r,i),this.add(new THREE.Mesh(o,a)),u.BASEBOARD.wrapT=THREE.RepeatWrapping,u.BASEBOARD.repeat.set(2,1),a=new THREE.MeshBasicMaterial({color:11184810,side:THREE.BackSide,map:u.BASEBOARD}),o=new f["default"](t,.04*r,i-.05),this.add(new THREE.Mesh(o,a))}return a(e,t),e}(THREE.Object3D),w=function(t){function e(t,r){n(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.amount=t,this.apothem=r}return a(e,t),c(e,[{key:"setCurtains",value:function(t){var e,r,i,n,a;for(i=new THREE.PlaneBufferGeometry(t,t,1,1),n=new THREE.MeshBasicMaterial({color:15658734,side:THREE.FrontSide,map:u.CURTAIN,transparent:!0}),e=.5;e<this.amount;e++)r=2*Math.PI*e/this.amount,a=new THREE.Mesh(i,n),a.rotation.x=Math.PI/2,a.rotation.y=-r,a.position.x=this.apothem*Math.sin(r),a.position.y=this.apothem*Math.cos(r),a.position.z=t/2-1,this.add(a);return n=null,i=null,a=null,this}},{key:"setCarpets",value:function(t,e){var r,i,n,a,o;for(u.REDCARPET.wrapT=THREE.RepeatWrapping,u.REDCARPET.repeat.set(1,3),a=new THREE.MeshLambertMaterial({color:16777215,side:THREE.FrontSide,map:u.REDCARPET}),n=new THREE.PlaneBufferGeometry(t,e,1,1),r=.5;r<this.amount;r++)i=r/this.amount*2*Math.PI,o=new THREE.Mesh(n,a),o.rotation.z=i,o.position.x=(this.apothem-e/2)*Math.sin(-i),o.position.y=(this.apothem-e/2)*Math.cos(i),o.position.z=.05,this.add(o);return a=null,n=null,o=null,this}},{key:"setPillars",value:function(t,e){var r,i,n,a,o,s,c;for(r=u.COLUMN,r.wrapT=THREE.RepeatWrapping,r.repeat.set(1,2),i=new THREE.MeshBasicMaterial({color:16777215,side:THREE.FrontSide,map:r}),n=new f["default"](4,e,t),s=[0,.17578125,.4453125,.73046875,1],o=0;4>o;o++)n.attributes.uv.array[12*o+0]=s[o+1],n.attributes.uv.array[12*o+1]=1,n.attributes.uv.array[12*o+2]=s[o],n.attributes.uv.array[12*o+3]=1,n.attributes.uv.array[12*o+4]=s[o],n.attributes.uv.array[12*o+5]=0,n.attributes.uv.array[12*o+6]=s[o],n.attributes.uv.array[12*o+7]=0,n.attributes.uv.array[12*o+8]=s[o+1],n.attributes.uv.array[12*o+9]=0,n.attributes.uv.array[12*o+10]=s[o+1],n.attributes.uv.array[12*o+11]=1;for(c=Math.atan(.46*Math.tan(Math.PI/this.amount)),o=0;o<this.amount;o++)s=2*Math.PI*o/this.amount,a=new THREE.Mesh(n,i),a.rotation.z=Math.PI/2-s,a.position.x=this.apothem*Math.sin(s+c),a.position.y=this.apothem*Math.cos(s+c),this.add(a),a=new THREE.Mesh(n,i),a.rotation.z=Math.PI/2-s,a.position.x=this.apothem*Math.sin(s-c),a.position.y=this.apothem*Math.cos(s-c),this.add(a);return r=null,i=null,n=null,a=null,this}}]),e}(THREE.Object3D),g=function(t){function e(){n(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var t,r,i;t=new THREE.MeshBasicMaterial({color:16777215,side:THREE.FrontSide,map:u.REDCARPET}),r=new d["default"](17.5,27.5,32),i=new THREE.Mesh(r,t),i.position.z=1,this.add(i),t=new THREE.MeshBasicMaterial({color:0,side:THREE.FrontSide}),r=new THREE.CylinderGeometry(27.5,27.5,1,32,1,!0),i=new THREE.Mesh(r,t),i.rotation.x=Math.PI/2,i.rotation.y=11.25*Math.PI/180,i.position.z=.5,this.add(i),t=null,r=null,i=null}return a(e,t),e}(THREE.Object3D),T=function(t){function e(){n(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var t,r,i,a,o,s,c;for(t=u.WOOD,r=new THREE.MeshLambertMaterial({color:16777215,emissive:3355443,side:THREE.BackSide,map:t}),i=new THREE.CylinderGeometry(17.5,15.5,1,16,1,!0),i.faceVertexUvs[0]=[],s=[new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(1,1)],c=[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1)],o=0;16>o;o++)i.faceVertexUvs[0].push(s),i.faceVertexUvs[0].push(c);for(a=new THREE.Mesh(i,r),a.name="platfront",a.rotation.x=Math.PI/2,a.rotation.y=11.25*Math.PI/180,a.position.z=.5,this.add(a),r=new THREE.MeshLambertMaterial({color:16777215,emissive:2236962,side:THREE.FrontSide,map:t}),i=[new v["default"](17,1),new THREE.BoxGeometry(7,1.5,1),new THREE.BoxGeometry(7,1.2,1)],o=0;16>o;o++)a=new THREE.Mesh(i[0],r),a.rotation.z=360*(o+.5)/16*Math.PI/180,this.add(a),a=new THREE.Mesh(i[1],r),a.rotation.z=(90+360*o/16)*Math.PI/180,a.position.x=19.1*Math.cos(o/8*Math.PI),a.position.y=19.1*Math.sin(o/8*Math.PI),a.position.z=9.8,this.add(a),a=new THREE.Mesh(i[2],r),a.rotation.z=(90+360*o/16)*Math.PI/180,a.position.x=17.5*Math.cos(o/8*Math.PI),a.position.y=17.5*Math.sin(o/8*Math.PI),a.position.z=1.6,this.add(a);t=u.CLOUDS,t.wrapT=t.wrapS=THREE.RepeatWrapping,t.repeat.set(30,1),r=new THREE.MeshLambertMaterial({color:3377551,emissive:3377551,side:THREE.FrontSide,map:t}),i=new THREE.TorusGeometry(16.2,.35,10,80),a=new THREE.Mesh(i,r),a.position.z=10.1,this.add(a),t=r=i=a=null}return a(e,t),e}(THREE.Object3D);Object.defineProperties(E,{TEXTURE_RELATIVE_URI:{value:"/resources/textures/"},CylinderBufferGeometry:{value:f["default"]},PlatformBufferGeometry:{value:d["default"]},StandGeometry:{value:v["default"]},Floor:{value:m},Walls:{value:b},Exits:{value:w},Platform:{value:g},TrialStands:{value:T}}),r["default"]=E,e.exports=r["default"]},{"./CylinderBufferGeometry.js":7,"./PlatformBufferGeometry.js":10,"./StandGeometry.js":13}],7:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},o=function(t){function e(t,r,n){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.type="CylinderBufferGeometry";var o,s,u,c,h,l=n/Math.cos(Math.PI/t),f=2*Math.PI/t,p=new Float32Array(6*t*3),d=new Float32Array(6*t*2);for(o=0;t>=o;o++)s=l*Math.cos(f*(o-.5)),u=l*Math.sin(f*(o-.5)),c=l*Math.cos(f*(o+.5)),h=l*Math.sin(f*(o+.5)),d[12*o+0]=1,d[12*o+1]=1,p[18*o+0]=c,p[18*o+1]=h,p[18*o+2]=r,d[12*o+2]=0,d[12*o+3]=1,p[18*o+3]=s,p[18*o+4]=u,p[18*o+5]=r,d[12*o+4]=0,d[12*o+5]=0,p[18*o+6]=s,p[18*o+7]=u,p[18*o+8]=0,d[12*o+6]=0,d[12*o+7]=0,p[18*o+9]=s,p[18*o+10]=u,p[18*o+11]=0,d[12*o+8]=1,d[12*o+9]=0,p[18*o+12]=c,p[18*o+13]=h,p[18*o+14]=0,d[12*o+10]=1,d[12*o+11]=1,p[18*o+15]=c,p[18*o+16]=h,p[18*o+17]=r;this.addAttribute("position",new THREE.BufferAttribute(p,3)),this.addAttribute("uv",new THREE.BufferAttribute(d,2)),s=u=null,c=h=null,d=null,p=null}return n(e,t),e}(THREE.BufferGeometry);r["default"]=o,e.exports=r["default"]},{}],8:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./Stage.js"),c=i(u),h=t("./animation/DiscussionAnimation.js"),l=i(h),f=t("./hud/DiscussionScreen.js"),p=i(f),d=function(t){function e(t){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.screen=new p["default"](this.hudRenderer.ctx),this.hudRenderer.screen=this.screen,this.animation=new l["default"](t.renderer)}return a(e,t),o(e,[{key:"render",value:function(t){this.sceneRenderer&&this.sceneRenderer.render(t),this.hudRenderer&&this.hudRenderer.render(t),this.audioRenderer&&this.audioRenderer.render(t)}},{key:"promiseChainForDialogue",value:function(t,e,r){for(var i=this,n=Promise.resolve(!0),a=function(e,a){n=n.then(function(){return this.screen.setDialogue(this.characters[t],e,r),new Promise(function(t){setTimeout(t,Math.max(2500,50*e.length)),e=null,a=null})}.bind(i)),o=e,s=a},o=void 0,s=0;o=e[s];s++)a(o,s);return n}},{key:"queueNarratorScript",value:function(t){this.eventchain=this.eventchain.then(function(){var e=[];return e[0]=this.promiseChainForDialogue(t.speaker,t.dialogue),this.animation.tutorial(),Promise.all(e)}.bind(this))}},{key:"queueCharacterScript",value:function(t){this.eventchain=this.eventchain.then(function(){var e=this,r=[];if(r[0]=this.promiseChainForDialogue(t.speaker,t.dialogue,t.thought),"sprite"in t&&(this.characters[t.speaker].sprite=t.sprite),r[1]=Promise.resolve(),"camera"in t&&(r[1]=r[1].then(function(){return this.animation.cutTo(t.camera)}.bind(this))),"animation"in t)for(var i=function(i){r[1]=r[1].then(function(){return this.animation.transicion(t.animation[i])}.bind(e))},n=0;n<t.animation.length;n++)i(n);return Promise.all(r)}.bind(this))}}]),e}(c["default"]);r["default"]=d,e.exports=r["default"]},{"./Stage.js":12,"./animation/DiscussionAnimation.js":20,"./hud/DiscussionScreen.js":22}],9:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r){i(this,t),this.W=e,this.H=r;var n=document.createElement("canvas");n.width=e,n.height=r,this.ctx=n.getContext("2d"),this.blackScreen=0,n=null}return n(t,[{key:"drawBlackScreen",value:function(t){this.ctx.save(),this.ctx.globalAlpha=Math.min(this.blackScreen,1),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.W,this.H),this.ctx.restore()}},{key:"render",value:function(t){this.ctx.clearRect(0,0,this.W,this.H),this.processor&&this.processor(t),this.screen&&this.screen.draw(t),this.blackScreen>0&&this.drawBlackScreen()}},{key:"canvas",get:function(){return this.ctx.canvas}}]),t}();r["default"]=a,e.exports=r["default"]},{}],10:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},o=function(t){function e(t,r,n){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.type="PlatformBufferGeometry",t=t||20,r=r||31,n=n||32;var o,s,u,c,h,l=2*Math.PI/n,f=new Float32Array(6*n*3),p=new Float32Array(6*n*2);for(o=0;n>o;o++)s=Math.cos(l*o),u=Math.sin(l*o),c=Math.cos(l*(o+1)),h=Math.sin(l*(o+1)),p[12*o+0]=0,p[12*o+1]=0,f[18*o+0]=t*s,f[18*o+1]=t*u,f[18*o+2]=0,p[12*o+2]=1,p[12*o+3]=0,f[18*o+3]=r*s,f[18*o+4]=r*u,f[18*o+5]=0,p[12*o+4]=1,p[12*o+5]=1,f[18*o+6]=r*c,f[18*o+7]=r*h,f[18*o+8]=0,p[12*o+6]=1,p[12*o+7]=1,f[18*o+9]=r*c,f[18*o+10]=r*h,f[18*o+11]=0,p[12*o+8]=0,p[12*o+9]=1,f[18*o+12]=t*c,f[18*o+13]=t*h,f[18*o+14]=0,p[12*o+10]=0,p[12*o+11]=0,f[18*o+15]=t*s,f[18*o+16]=t*u,f[18*o+17]=0;this.addAttribute("position",new THREE.BufferAttribute(f,3)),this.addAttribute("uv",new THREE.BufferAttribute(p,2)),s=u=null,c=h=null,p=null,f=null}return n(e,t),e}(THREE.BufferGeometry);r["default"]=o,e.exports=r["default"]},{}],11:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=t("./CharacterCard.js"),s=i(o),u=function(){function t(e,r){n(this,t),this.W=e,this.H=r,this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(0,1),this.renderer.setSize(e,r),this.scene=new THREE.Scene;var i=new THREE.PointLight(16777215,1.5,130);i.position.set(0,0,30),this.scene.add(i),this.cameras=[],this.mainCamera=null,this.processor=null,this.addElement=this.scene.add.bind(this.scene)}return a(t,[{key:"render",value:function(t){this.processor&&this.processor(t),this.renderer.render(this.scene,this.mainCamera)}},{key:"createCamera",value:function(t){var e=new THREE.PerspectiveCamera(45,this.W/this.H,1,300);e.position.set(10,10,10),e.up.set(0,0,1),e.lookAt(new THREE.Vector3(0,0,10)),this.scene.add(e),this.cameras.push(e),this.mainCamera=e}},{key:"locateCharacter",value:function(t,e){var r=new s["default"](t);r.counter=Math.abs(e%16);var i=r.counter/16*(2*Math.PI);r.rotation.x=Math.PI/2,r.rotation.y=i-Math.PI/2,r.position.set((23-.5*Math.pow(-1,e))*Math.cos(i),(23-.5*Math.pow(-1,e))*Math.sin(i),11),this.scene.add(r),i=null}},{key:"heIsHere",value:function(t){var e=new s["default"](t);e.front.geometry=e.back.geometry=new THREE.PlaneBufferGeometry(10,10),e.rotation.x=Math.PI/2,e.rotation.y=Math.PI/2,e.position.set(-50,0,19);var r=new THREE.Mesh(new THREE.BoxGeometry(14,10,10),new THREE.MeshLambertMaterial({color:16763904}));r.position.set(-50,0,7),r.rotation.y=Math.PI/2,this.scene.add(e),this.scene.add(r)}},{key:"renderHalf",value:function(){this.renderer.setViewport(0,0,this.WIDTH,this.HEIGHT),this.renderer.clear(),this.renderer.setViewport(1,1,.5*this.WIDTH-2,this.HEIGHT-2),this.renderer.render(this.scene,this.mainCamera),this.renderer.setViewport(.5*this.WIDTH+1,1,.5*this.WIDTH-2,this.HEIGHT-2),this.renderer.render(this.scene,this.rightCamera)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),t}();r["default"]=u,e.exports=r["default"]},{"./CharacterCard.js":4}],12:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this.characters=e.characters,this.trial=e,this.sceneRenderer=e.renderer.scene,this.hudRenderer=e.renderer.hud,this.audioRenderer=e.renderer.audio,this.eventchain=Promise.resolve(),this._func=[],this.cuadro=0}return n(t,[{key:"render",value:function(t){throw new Error("Stage.Render: Not implemented.")}},{key:"stop",value:function(){return cancelAnimationFrame(this.cuadro),this}},{key:"step",value:function(t){return this.cuadro=requestAnimationFrame(t.bind(this)),this}},{key:"justKeepRendering",value:function(){var t=function(e){this.render(e),this.cuadro=requestAnimationFrame(t)}.bind(this);this.cuadro=requestAnimationFrame(t)}},{key:"next",value:function(t){return this.eventchain=this.eventchain.then(t.bind(this)),this}},{key:"nextPromise",value:function(t){return this.eventchain=this.eventchain.then(function(){return new Promise(t.bind(this))}.bind(this)),this}},{key:"delayPromise",value:function(t){return new Promise(function(e){setTimeout(e,t)})}},{key:"end",value:function(t){return this.eventchain.then(function(){return this.animation.exitSpin()}.bind(this)).then(function(){this.trial.changeStage(t.kind),this.trial.loadScript(t.file)}.bind(this))}}]),t}();r["default"]=a,e.exports=r["default"]},{}],13:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},o=function(t){function e(t,r){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.vertices.push(new THREE.Vector3(.8,t-2,r+10.2),new THREE.Vector3(-.8,t-2,r+10.2),new THREE.Vector3(-.8,t-2,r+8.7),new THREE.Vector3(.8,t-2,r+8.7),new THREE.Vector3(.8,t+4,r+10.2),new THREE.Vector3(-.8,t+4,r+10.2),new THREE.Vector3(-.8,t+4,r+8.5),new THREE.Vector3(.8,t+4,r+8.5),new THREE.Vector3(.8,t+0,r+7.5),new THREE.Vector3(-.8,t+0,r+7.5),new THREE.Vector3(-.8,t+3,r+7.5),new THREE.Vector3(.8,t+3,r+7.5)),this.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,3,0),new THREE.Face3(3,2,9),new THREE.Face3(9,8,3),new THREE.Face3(4,5,1),new THREE.Face3(1,0,4),new THREE.Face3(4,0,3),new THREE.Face3(3,7,4),new THREE.Face3(7,3,8),new THREE.Face3(8,11,7),new THREE.Face3(1,5,6),new THREE.Face3(6,2,1),new THREE.Face3(2,6,10),new THREE.Face3(10,9,2),new THREE.Face3(5,4,7),new THREE.Face3(7,6,5),new THREE.Face3(6,7,11),new THREE.Face3(11,10,6),new THREE.Face3(8,9,10),new THREE.Face3(10,11,8)),this.vertices.push(new THREE.Vector3(.6,t+.2,r+7.5),new THREE.Vector3(-.6,t+.2,r+7.5),new THREE.Vector3(-.6,t+.2,r+1.1),new THREE.Vector3(.6,t+.2,r+1.1),new THREE.Vector3(-.6,t+2.8,r+7.5),new THREE.Vector3(.6,t+2.8,r+7.5),new THREE.Vector3(.6,t+2.8,r+1.1),new THREE.Vector3(-.6,t+2.8,r+1.1)),this.faces.push(new THREE.Face3(12,13,14),new THREE.Face3(14,15,12),new THREE.Face3(16,17,18),new THREE.Face3(18,19,16),new THREE.Face3(17,12,15),new THREE.Face3(15,18,17),new THREE.Face3(13,16,19),new THREE.Face3(19,14,13)),this.vertices.push(new THREE.Vector3(.8,t+0,r+1.4),new THREE.Vector3(-.8,t+0,r+1.4),new THREE.Vector3(-.8,t+0,r+0),new THREE.Vector3(.8,t+0,r+0),new THREE.Vector3(-.8,t+3,r+1.4),new THREE.Vector3(.8,t+3,r+1.4),new THREE.Vector3(.8,t+4,r+.7),new THREE.Vector3(-.8,t+4,r+.7),new THREE.Vector3(.8,t+4,r+0),new THREE.Vector3(-.8,t+4,r+0)),this.faces.push(new THREE.Face3(20,21,22),new THREE.Face3(22,23,20),new THREE.Face3(25,24,21),new THREE.Face3(21,20,25),new THREE.Face3(20,23,28),new THREE.Face3(28,26,20),new THREE.Face3(26,25,20),new THREE.Face3(24,25,26),new THREE.Face3(26,27,24),new THREE.Face3(27,26,28),new THREE.Face3(28,29,27),new THREE.Face3(21,24,27),new THREE.Face3(21,27,29),new THREE.Face3(21,29,22));var n=this.faces.length/2,o=[new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(1,1)],s=[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1)];for(this.faceVertexUvs[0]=[];n--;)this.faceVertexUvs[0].push(o,s);this.computeFaceNormals(),this.computeVertexNormals()}return n(e,t),e}(THREE.Geometry);r["default"]=o,e.exports=r["default"]},{}],14:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),
Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.geometry=new THREE.SphereGeometry(.5,3,2)}return n(t,[{key:"getVector",value:function(t){return{x:this.getX(t),y:this.getY(t),z:this.getZ(t)}}},{key:"getVector3",value:function(t){return new THREE.Vector3(this.getX(t),this.getY(t),this.getZ(t))}},{key:"drawPath",value:function(t){for(var e=void 0,r=new THREE.LineBasicMaterial({color:Math.floor(16777215*Math.random())}),i=new THREE.Geometry,n=0;1>=n;n+=.1)i.vertices.push(this.getVector3(n));return e=new THREE.Line(i,r),t.add(e),e}}]),t}();r["default"]=a,e.exports=r["default"]},{}],15:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./Trayectoria.js"),c=i(u),h=function(t){function e(t,r,i){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),i=i||{},this.cx=i.x||0,this.cy=i.y||0,this.ax=t.x-this.cx,this.bx=r.x-this.cx,this.ay=t.y-this.cy,this.by=r.y-this.cy,this.az=t.z,this.dz=r.z-t.z,this.ar=Math.sqrt(this.ax*this.ax+this.ay*this.ay),this.br=Math.sqrt(this.bx*this.bx+this.by*this.by),this.ap=Math.atan2(this.ay,this.ax),this.bp=Math.atan2(this.by,this.bx),this.bp-this.ap>Math.PI?this.ap+=2*Math.PI:this.bp-this.ap<-Math.PI&&(this.bp+=2*Math.PI),t=null,r=null,i=null}return a(e,t),o(e,[{key:"getX",value:function(t){return this.cx+this.getR(t)*Math.cos(this.getP(t))}},{key:"getY",value:function(t){return this.cy+this.getR(t)*Math.sin(this.getP(t))}},{key:"getZ",value:function(t){return this.az+t*this.dz}},{key:"getR",value:function(t){return(1-t)*this.ar+t*this.br}},{key:"getP",value:function(t){return(1-t)*this.ap+t*this.bp}}]),e}(c["default"]);r["default"]=h,e.exports=r["default"]},{"./Trayectoria.js":14}],16:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./Trayectoria.js"),c=i(u),h=function(t){function e(t,r,i){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,r),i=i||{},this.cx=i.x||0,this.cy=i.y||0,this.cz=i.z||0,this.ax=t.x-this.cx,this.ay=t.y-this.cy,this.az=t.z-this.cz,this.ar=Math.sqrt(this.ax*this.ax+this.ay*this.ay+this.az*this.az),this.ap=Math.atan2(this.ay,this.ax),this.at=Math.acos(this.az/Math.sqrt(this.ax*this.ax+this.ay*this.ay+this.az*this.az)),this.bx=r.x-this.cx,this.by=r.y-this.cy,this.bz=r.z-this.cz,this.br=Math.sqrt(this.bx*this.bx+this.by*this.by+this.bz*this.bz),this.bp=Math.atan2(this.by,this.bx),this.bt=Math.acos(this.bz/Math.sqrt(this.bx*this.bx+this.by*this.by+this.bz*this.bz)),this.bp-this.ap>Math.PI?this.ap+=2*Math.PI:this.bp-this.ap<-Math.PI&&(this.bp+=2*Math.PI),t=null,r=null,i=null}return a(e,t),o(e,[{key:"getX",value:function(t){return"spherical"==this.path?this.cx+this.getR(t)*Math.sin(this.getT(t))*Math.cos(this.getP(t)):"circular"==this.path?this.cx+this.getR(t)*Math.cos(this.getP(t)):(1-t)*this.ax+t*this.bx}},{key:"getY",value:function(t){return"spherical"==this.path?this.cy+this.getR(t)*Math.sin(this.getT(t))*Math.sin(this.getP(t)):"circular"==this.path?this.cy+this.getR(t)*Math.sin(this.getP(t)):(1-t)*this.ay+t*this.by}},{key:"getZ",value:function(t){return"spherical"==this.path?this.cz+this.getR(t)*Math.cos(this.getT(t)):(1-t)*this.az+t*this.bz}},{key:"getR",value:function(t){return(1-t)*this.ar+t*this.br}},{key:"getP",value:function(t){return(1-t)*this.ap+t*this.bp}},{key:"getT",value:function(t){return(1-t)*this.at+t*this.bt}}]),e}(c["default"]);r["default"]=h,e.exports=r["default"]},{"./Trayectoria.js":14}],17:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./Trayectoria.js"),c=i(u),h=function(t){function e(t,r){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.ax=t.x,this.ay=t.y,this.az=t.z,this.dx=r.x-t.x,this.dy=r.y-t.y,this.dz=r.z-t.z,t=null,r=null}return a(e,t),o(e,[{key:"getX",value:function(t){return this.ax+t*this.dx}},{key:"getY",value:function(t){return this.ay+t*this.dy}},{key:"getZ",value:function(t){return this.az+t*this.dz}}]),e}(c["default"]);r["default"]=h,e.exports=r["default"]},{"./Trayectoria.js":14}],18:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=t("./Character.js"),s=i(o),u=t("./DiscussionStage.js"),c=i(u),h=function(){function t(e,r){n(this,t),this.W=e,this.H=r,this.characters={},this.renderer={}}return a(t,[{key:"setupRenderer",value:function(t,e){return this.renderer[t]=e,this}},{key:"setNarrator",value:function(t){this.characters.narrator=new s["default"]({id:s["default"].NARRATOR,name:t})}},{key:"setCharacter",value:function(t,e){t&&(t=new s["default"](t),this.characters[t.id]=t,this.renderer.scene.locateCharacter(t,e))}},{key:"putTheFuckingBear",value:function(){var t=new s["default"]({id:"monokuma",name:"Monokuma"});this.characters.monokuma=t,this.renderer.scene.heIsHere(t)}},{key:"changeStage",value:function(t){switch(t){case"discussion":this.stage=new c["default"](this)}}},{key:"loadScript",value:function(t){fetch(t).then(function(t){return t.json()}).then(function(t){t.forEach(this.parseScript,this)}.bind(this))}},{key:"parseScript",value:function(t){t.kind?this.stage.end(t):"narrator"==t.speaker?this.stage.queueNarratorScript(t):this.stage.queueCharacterScript(t)}}]),t}();r["default"]=h,e.exports=r["default"]},{"./Character.js":3,"./DiscussionStage.js":8}],19:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=t("./Coordenada.js"),s=i(o),u=t("./TrayectoriaLineal.js"),c=i(u),h=t("./TrayectoriaCircular.js"),l=i(h),f=t("./TrayectoriaEsferica.js"),p=i(f),d=t("./easing.js"),y=i(d),v=function(){function t(e,r,i){n(this,t),this.duration=e,this.path=r||"linear",this.easing=i||"linear"}return a(t,[{key:"getPosition",value:function(t){return this.position.getVector(this.position.easing(t))}},{key:"getDirection",value:function(t){return this.direction.getVector(this.direction.easing(t))}},{key:"getFOV",value:function(t){return this.fov.start+this.fov.delta*this.fov.easing(t)}},{key:"getUp",value:function(t){return this.up.getVector(this.up.easing(t))}},{key:"setupPosition",value:function(t,e,r){switch(r.path||this.path){case"circular":this.position=new l["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"spherical":this.position=new p["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"linear":default:this.position=new c["default"](s["default"].parse(t),s["default"].parse(e))}this.position.easing=y["default"][r.easing||this.easing],r=null}},{key:"setupDirection",value:function(t,e,r){switch(r.path||this.path){case"circular":this.direction=new l["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"spherical":this.direction=new p["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"linear":default:this.direction=new c["default"](s["default"].parse(t),s["default"].parse(e))}this.direction.easing=y["default"][r.easing||this.easing],r=null}},{key:"setupFOV",value:function(t,e,r){this.fov={start:t,delta:e-t,easing:y["default"][r.easing||this.easing]},r=null}},{key:"setupUp",value:function(t,e,r){switch(r.path||this.path){case"circular":this.up=new l["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"spherical":this.up=new p["default"](s["default"].parse(t),s["default"].parse(e),r.center);break;case"linear":default:this.up=new c["default"](s["default"].parse(t),s["default"].parse(e))}this.up.easing=y["default"][r.easing||this.easing],r=null}},{key:"runStage",value:function(t,e){this.fov&&(t.fov=this.getFOV(e))&&t.updateProjectionMatrix(),this.position&&t.position.copy(this.getPosition(e)),this.up&&t.up.copy(this.getUp(e)),this.direction&&t.lookAt(this.getDirection(e))}},{key:"delta",value:function(t){return this.start||(this.start=t),(t-this.start)/this.duration}}]),t}();r["default"]=v,e.exports=r["default"]},{"./Coordenada.js":5,"./TrayectoriaCircular.js":15,"./TrayectoriaEsferica.js":16,"./TrayectoriaLineal.js":17,"./easing.js":21}],20:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./../Coordenada.js"),c=i(u),h=t("./../Trayectoria.js"),l=(i(h),t("./../Animation.js")),f=i(l),p=function(t){function e(t){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return a(e,t),o(e,[{key:"randomDialogue",value:function(){var t,e,r,i,n=juicio.characters[Object.keys(juicio.characters)[Math.floor(15*Math.random())]],a=n.card.counter;screen.setDialogue(n,"I actually looked at the crime scene for more than 2 seconds, something you should try to do sometimes..."),juicio.mainCamera.up.x=(Math.random()-.5)/2,juicio.mainCamera.up.z=5,juicio.mainCamera.up.normalize(),r=.5*(Math.random()-.5),i=10*(Math.random()-.5),t=function(n){var o=(n-e)/1e4,s=2*Math.PI*(a+r*o)/16;juicio.mainCamera.position.set((9+i*o)*Math.cos(s),(9+i*o)*Math.sin(s),16),juicio.mainCamera.lookAt({x:25*Math.cos(s),y:25*Math.sin(s),z:16}),juicio.render(n),f["default"].step(t)},juicio.animation.stop(),e=window.performance.now()+5e3,f["default"].step(t)}},{key:"tutorial",value:function(){return new Promise(function(t){this.mainCamera.up.set(0,0,1),this.mainCamera.fov=40,this.mainCamera.updateProjectionMatrix(),this.processor=function(t){var e=2*Math.PI*(t%6e4)/6e4;this.mainCamera.position.set(-28*Math.cos(e),-28*Math.sin(e),33),this.mainCamera.lookAt(new THREE.Vector3(19*Math.cos(e),19*Math.sin(e),9))}}.bind(this.scene))}},{key:"cuestionamiento",value:function(t){return this.cutTo({fov:40,up:new c["default"](0,0,1),position:c["default"].parse({r:10,p:t.azimuth,z:17}),direction:c["default"].parse({r:26,p:t.azimuth,z:15})}).then(function(){return this.transicion({fov:54,duration:4*(t.duration||600)/7,position:c["default"].parse({r:3,p:t.azimuth,z:16}),direction:c["default"].parse({r:26,p:t.azimuth,z:15}),easing:"outQuad"})}.bind(this)).then(function(){return this.transicion({fov:60,duration:3*(t.duration||600)/7,position:c["default"].parse({r:10,p:t.azimuth,z:17}),direction:c["default"].parse({r:26,p:t.azimuth,z:15}),easing:"inCubic"})}.bind(this))}},{key:"exitSpin",value:function(){return new Promise(function(t){var e,r=c["default"].parse(this.scene.mainCamera.up),i=c["default"].parse(this.scene.mainCamera.position),n=c["default"].parse(new THREE.Vector3(0,0,-10).applyMatrix4(this.scene.mainCamera.matrixWorld)),a={r:r.r,dp:r.p-i.p,z:r.z},o={r:n.r,dp:n.p-i.p,z:n.z};n=null,r=null,this.hud.processor=function(r){var i=(r-e)/1e3;i>=2?(this.processor=null,t()):i>1?this.blackScreen=i-1:this.blackScreen=0},this.scene.processor=function(t){e||(e=t);var r=(t-e)/1e3,n=i.p-r*Math.PI;this.mainCamera.position.set(i.r*Math.cos(n),i.r*Math.sin(n),i.z*(1-r/2)+19*r/2),this.mainCamera.lookAt(new THREE.Vector3(o.r*Math.cos(n+o.dp),o.r*Math.sin(n+o.dp),o.z*(1-r/2)+19*r/2)),this.mainCamera.up.set(a.r*Math.cos(n+a.dp),a.r*Math.sin(n+a.dp),a.z),r>=2&&(e=null,i=null,this.processor=null)}}.bind(this))}}]),e}(f["default"]);r["default"]=p,e.exports=r["default"]},{"./../Animation.js":2,"./../Coordenada.js":5,"./../Trayectoria.js":14}],21:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]={none:function(){return 1},linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return-t*(t-2)},inOutQuad:function(t){return.5*((t*=2)<1?t*t:t*(2-t)-2)},inCubic:function(t){return t*t*t},outCubic:function(t){return Math.pow(t-1,3)+1},inOutCubic:function(t){return.5*((t*=2)<1?t*t*t:Math.pow(2*t-2,3)+2)},inSine:function(t){return 1-Math.cos(t*Math.PI/2)},outSine:function(t){return Math.sin(t*Math.PI/2)},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return Math.pow(1024,t-1)},easeOutExpo:function(t){return 1.0009765626-Math.pow(1024,-t)},easeInOutExpo:function(t){return.5*((t*=2)<1?Math.pow(1024,t-1):2-Math.pow(1024,1-t))}},e.exports=r["default"]},{}],22:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},u=t("./Screen.js"),c=i(u),h=t("./TextElement.js"),l=i(h),f=t("./../Character.js"),p=function(t){function e(t){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.gradients=function(){var e=t.canvas.width,r=t.createLinearGradient(0,0,e,0),i=t.createLinearGradient(0,0,e,0),n=t.createLinearGradient(0,0,e,0);return r.addColorStop(0,"#CC0000"),r.addColorStop(.65,"rgb(255, 51, 51)"),r.addColorStop(.75,"rgba(255, 51, 51, 0)"),i.addColorStop(.65,"rgb(255, 51, 51)"),i.addColorStop(.75,"rgba(255, 51, 51, 0)"),n.addColorStop(.65,"rgb(255, 51, 51)"),n.addColorStop(.75,"rgba(255, 51, 51, 0)"),{nameprotagLeft:r,nametagLeft:i,nametagRight:n}}(),this.caseNumber="02",this.banner_x=0,this.speakerCardTimer=0,this.speakerCardImage=new Image,this.speakerCardImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this.dialogue=new l["default"](t),this.dialogue.x=.05*this.W,this.dialogue.y=.8*this.H,this.dialogue.typewrite=!0,this.nametag=new l["default"](t),this.nametag.x=.03*this.W,this.nametag.y=.675*this.H,this.nametag.font=.04*this.H+"px Aero, sans-serif",this.add(this.dialogue,this.nametag)}return a(e,t),o(e,[{key:"setDialogue",value:function(t,e,r){this.speakerId!=t.id&&(this.generateInterferencePattern(),this.interferenceOpacity=1,this.nametag.marginLeft=.04*this.W,this.nametag.opacity=0),this.speakerId=t.id,this.speakerIsProtagonist=t.card&&0==t.card.counter,this.speakerCardImage.src=t.bustSpriteUri,this.nametag.text=t.name.split("").join(String.fromCharCode(8202)),this.dialogue.text=e,this.dialogue.typewLength=0,r?this.dialogue.color=this.constructor.COLOR_THOUGHT:t.id==f.NARRATOR?this.dialogue.color=this.constructor.COLOR_NARRATOR:this.dialogue.color=this.constructor.COLOR_CHARACTER}},{key:"generateInterferencePattern",value:function(){this.interferencePattern=this.ctx.createLinearGradient(0,.08*this.H,0,.63*this.H);for(var t,e="0",r="0",i=Math.floor(this.H/100);i--;)e+=Math.floor(500*Math.random()).toString(2),r+=Math.floor(500*Math.random()).toString(2);for(t=i=Math.min(e.length,r.length);i--;)e[i]!=r[i]&&(this.interferencePattern.addColorStop(i/t-.005,"#ff3333"),this.interferencePattern.addColorStop(i/t,"#ffffff"),this.interferencePattern.addColorStop(i/t+.005,"#ff3333"))}},{key:"drawClassTrialBanner",value:function(){this.ctx.save(),this.ctx.font=.08*this.H+"px Goodbye Despair",this.ctx.globalAlpha=.5,this.ctx.fillStyle="rgba(255,255,255,0.5)",this.ctx.strokeStyle="white",this.ctx.lineWidth=this.H/500;var t=this.ctx.measureText("class trial ").width;this.ctx.fillText("class trial class trial class trial class trial class trial ",this.banner_x,.06*this.H),this.ctx.strokeText("class trial class trial class trial class trial class trial ",this.banner_x,.06*this.H),this.banner_x-=this.W/1e3,this.banner_x<-t&&(this.banner_x+=t),t=null,this.ctx.restore()}},{key:"drawSpeakerCard",value:function(){var t,e=.19*this.W;this.speakerCardTimer+=.03,this.speakerCardTimer>=1&&(this.speakerCardTimer=-1),this.ctx.save(),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,e,.63*this.H),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(.1*this.W,0),this.ctx.lineTo(.1*this.W+.07*this.H,.07*this.H),this.ctx.lineTo(0,.07*this.H),this.ctx.closePath(),this.ctx.fillStyle="#999999",this.ctx.fill(),this.ctx.font=.06*this.H+"px Goodbye Despair",this.ctx.fillStyle="#ffffff",this.ctx.fillText("case",.01*this.W,.054*this.H),this.ctx.textAlign="right",this.ctx.fillStyle="#ff3333",this.ctx.fillText(this.caseNumber,.19*this.W-.01*this.H,.054*this.H),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,.075*this.H,e-.005*this.H,.55*this.H),this.ctx.clip();var r=this.ctx.createLinearGradient(0,(-1.02+.55*this.speakerCardTimer)*this.H,0,(.08+1.1+.55*this.speakerCardTimer)*this.H);for(r.addColorStop(0,"#FF0000"),r.addColorStop(.25,"#000000"),r.addColorStop(.5,"#FF0000"),r.addColorStop(.75,"#000000"),r.addColorStop(1,"#FF0000"),this.ctx.fillStyle=r,this.ctx.fillRect(0,0,e,this.H),r=null,this.ctx.strokeStyle="#"+("0"+Math.floor(Math.abs(255*this.speakerCardTimer)).toString(16)).slice(-2)+"0000",this.ctx.lineWidth=this.H/200,t=.625+e/this.H;t>.075;)this.ctx.beginPath(),this.ctx.moveTo(e-.0025*this.H,t*this.H),this.ctx.lineTo(-.0025*this.H,t*this.H-e),this.ctx.stroke(),t-=.03;t=1.6*.55*this.H,this.ctx.drawImage(this.speakerCardImage,(e-t/this.speakerCardImage.naturalHeight*this.speakerCardImage.naturalWidth)/2,.075*this.H,t/this.speakerCardImage.naturalHeight*this.speakerCardImage.naturalWidth,t),this.interferenceOpacity>0&&(this.ctx.globalAlpha=this.interferenceOpacity,this.ctx.fillStyle=this.interferencePattern,this.ctx.fillRect(0,.075*this.H,e,.55*this.H),this.interferenceOpacity-=.08),this.ctx.restore(),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=this.H/500,this.ctx.beginPath(),this.ctx.moveTo(e-.005*this.H,0),this.ctx.lineTo(e-.005*this.H,.07*this.H),this.ctx.stroke(),this.ctx.strokeRect(-.005*this.H,.075*this.H,e,.55*this.H),this.ctx.restore(),e=null}},{key:"drawDialogBackground",value:function(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,.69*this.H,this.W,.31*this.H),this.ctx.fillStyle=this.gradients[this.speakerIsProtagonist?"nameprotagLeft":"nametagLeft"],this.ctx.fillRect(0,.63*this.H,this.W,.06*this.H),this.ctx.fillStyle="white",this.ctx.fillRect(0,.693*this.H,this.W,.02*this.H),this.ctx.fillStyle="#FF0066",this.ctx.fillRect(0,.713*this.H,this.W,.01*this.H),this.ctx.restore()}},{key:"draw",value:function(t){this.ctx.clearRect(0,0,this.W,this.H),this.drawClassTrialBanner(),this.drawDialogBackground(),this.speakerId!=f.NARRATOR&&this.drawSpeakerCard(),this.dialogue.draw(),this.nametag.marginLeft>0&&(this.nametag.marginLeft-=.005*this.W),this.nametag.opacity<1&&(this.nametag.opacity+=.1),this.nametag.draw()}}]),e}(c["default"]);p.COLOR_NARRATOR="#47FF19",p.COLOR_CHARACTER="white",p.COLOR_THOUGHT="#5ac3d8",r["default"]=p,e.exports=r["default"]},{"./../Character.js":3,"./Screen.js":24,"./TextElement.js":25}],23:[function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this.type="HUD.Element",this.ctx=e,this.W=e.canvas.width,this.H=e.canvas.height,this.relative_x=0,this.relative_y=0,this.visible=!0,this.opacity=1,this.parent=void 0,this.children=[],this.events={}}return n(t,[{key:"add",value:function(e){if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return e===this?(console.error("HUD.Element$add: object can't be added as a child of itself.",e),this):(e instanceof t?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("HUD.Element$add: object not an instance of HUDElement.",e),this)}},{key:"remove",value:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var r=this.children.indexOf(t);-1!==r&&(t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(r,1))}},{key:"getChildrenByType",value:function(t){for(var e=[],r=this.children.length;r--;)this.children[r].type==t&&e.push(this.children[r]),this.children[r].children.length>0&&(e=e.concat(this.children[r].getChildrenByType(t)));return e}},{key:"getChildByType",value:function(t){for(var e,r=0,i=this.children.length,r=0;r<this.children.length;r++){if(this.children[i].type==t)return this.children[i];if(this.children[i].children.length>0&&(e=this.children[i].getChildByType(t)))return e}}},{key:"dispatchEvent",value:function(t){t.type in this.events&&this.events[t.type].forEach(function(e){e(t)})}},{key:"listenEvent",value:function(t,e){t in this.events||(this.events[t]=[]),this.events[t].push(e)}},{key:"draw",value:function(t){throw new Error("HUD.Element$draw: Method not implemented.",this.type)}},{key:"drawChildren",value:function(t){for(var e=void 0,r=0;e=this.children[r];r++)e.draw(t)}}]),t}();r["default"]=a,e.exports=r["default"]},{}],24:[function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},s=t("./Element.js"),u=i(s),c=function(t){function e(t){n(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.type="HUD.Screen"}return a(e,t),e}(u["default"]);r["default"]=c,e.exports=r["default"]},{"./Element.js":23}],25:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return;t=c,e=a,r=o,i=!0,s=c=void 0}},c=t("./Element.js"),h=n(c),l=function(t){function e(t,r,i){a(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.type="HUD.TextElement",this.text=r||"",this.color="white",this.x=0,this.y=0,this.maxWidth=.9*this.W,this.marginLeft=0,this.font=.06*this.H+"px Calibri",this.color="white",this.lineHeight=.08*this.H,this.typewrite=!1,this.typewLength=0}return o(e,t),s(e,[{key:"draw",value:function(t){this.ctx.save(),this.ctx.globalAlpha=this.opacity,this.ctx.fillStyle=this.color,this.ctx.font=this.font,this.writeLine(this.text,this.marginLeft+this.x,this.y,this.maxWidth),this.ctx.restore()}},{key:"typewriteStep",value:function(t){return t.length>this.typewLength&&(this.typewLength+=1),t.substr(0,this.typewLength)}},{key:"writeLine",value:function(t,e,r,i){this.typewrite&&(t=this.typewriteStep(t));for(var n="",a=this.ctx.measureText(t).width,o=t.split(" "),s=[];a>i;)n=o.pop(),s.unshift(n),t=o.join(" "),a=this.ctx.measureText(t).width;if(!(o.length>0))throw new Error("TextElement: El texto contiene una palabra ms ancha que el ancho mximo del canvas.");this.ctx.fillText(t,e,r),s.length>0&&this.writeLine(s.join(" "),e,r+this.lineHeight,i),n=null,a=null,o=null,s=null}},{key:"draw2",value:function(t){var e=text.substr(this.textAdvance),r=(e.indexOf(" ")+1||text.length+1)-1,n=this.ctx.measureText(e.substring(0,r)).width,a=t.measureText(str.charAt(i)).width;cursorX+n>=canvas.width-padding&&(cursorX=startX,cursorY+=lineHeight),t.fillText(str.charAt(i),cursorX,cursorY),i++,cursorX+=a}}]),e}(h["default"]);r["default"]=l,e.exports=r["default"]},{"./Element.js":23}]},{},[1]);
//# sourceMappingURL=bundle.js.map
